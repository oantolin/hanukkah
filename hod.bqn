csv â‡ BQNLib "csv"

DLData â‡ {ğ•¤
 â€¢SH âŸ¨"wget", "https://hanukkah.bluebird.sh/5784/noahs-csv.zip"âŸ©
 â€¢SH âŸ¨"unzip", "-P", "5777", "noahs-csv.zip"âŸ©
}

LoadTable â‡ {
 hâ€¿t â† (âŠ‘â‹ˆ(â‰âˆ˜>1â†“Â¯1â†“âŠ¢)) csv.Split â€¢FChars "5784/noahs-"âˆ¾ğ•©âˆ¾".csv"
 (â€¢BQN "{["âˆ¾(1â†“âˆ¾','âˆ¾Â¨h)âˆ¾"]â‡ğ•©}") {ğ•ğ•©} â€¢ParseFloatÂ¨âŠâŠ¢Ë˜t
}
 
Load â‡ {ğ•¤
 customersâ€¿ordersâ€¿itemsâ€¿products â‡ LoadTableÂ¨ âŸ¨
  "customers", "orders", "orders_items", "products"
 âŸ©
}

# String utilities

Split â‡  ((âŠ¢-Ëœ+`Ã—Â¬)=)âŠ”âŠ¢                # from bqncrate

LowerCase â‡ (('a'-'A')Ã—'A'âŠ¸â‰¤âˆ§â‰¤âŸœ'Z')âŠ¸+

# Find someone with phone number = last name on the keypad

suffixes â† âŸ¨"I", "II", "III", "IV", "V", "Jr."âŸ©

LastName â‡ Â¯1âŠ‘Â·(âˆŠâŸœsuffixesâŒ¾< Â¯1âŠ¸âŠ‘)âŠ¸â†“ ' 'âŠ¸Split

D1 â‡ { âŸ¨câ‡customersâŸ© :
 keypad â† 1+"adgjmptw"âŠ¸â‹Â¨ LowerCase LastNameÂ¨ c.name
 phones â† '0' -Ëœ '-'âŠ¸â‰ âŠ¸/Â¨ c.phone
 âŠ‘ (phones â‰¡Â¨ keypad) / c.phone
}

# Find a JP who bought bagels in 2017

D2 â‡ { âŸ¨câ‡customers,oâ‡orders,iâ‡items,pâ‡productsâŸ© :
 jp â† c.customerid /Ëœ ("J P"â‰¡3â†‘'a'âŠ¸>âŠ¸/)Â¨ c.name
 bo â† i.orderid /Ëœ i.sku âˆŠ p.sku /Ëœ "Bagel"âŠ¸(âˆ¨Â´â·)Â¨ p.desc
 m â† (o.customeridâˆŠjp) âˆ§  (o.orderidâˆŠbo) âˆ§ ("2017"â‰¡4âŠ¸â†‘)Â¨o.ordered
 c.phone âŠ‘Ëœ c.customerid âŠ m/o.customerid
}

# Find a Cancer born in a year of the rabbit who bought rug
# cleaner

# Chinese years don't exactly line up with Gregorian ones,
# so for example one year of the rabbit was from 25 January
# 1963 to 12 February 1964, but if you are a Cancer you must
# be from the first of those calendar years, i.e. a year
# that is 7 mod 12. Cancer goes from June 22 to July 22.

D3 â‡ { âŸ¨câ‡customers,oâ‡orders,iâ‡items,pâ‡productsâŸ© :
 [y,m,d] â† â‰ > â€¢ParseFloatÂ¨âˆ˜('-'âŠ¸Split)Â¨ c.birthdate
 dob â† (7=12|y) âˆ§ ((m=6)âˆ§dâ‰¥22) âˆ¨ ((m=7)âˆ§dâ‰¤22)
 rco â† i.orderid /Ëœ i.sku âˆŠ p.sku /Ëœ "Rug Cleaner"âŠ¸(âˆ¨Â´â·)Â¨ p.desc
 brc â† o.customerid /Ëœ o.orderid âˆŠ rco
 (dob âˆ§ c.customerid âˆŠ brc) / â‰[c.name, c.birthdate, c.phone]
}
